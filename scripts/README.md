# Scripts

## scan_url_client.py

Client script that simulates the presigned URL scan workflow:

1. Uploads a file to S3 (MinIO)
2. Generates a presigned URL for the uploaded object
3. Sends the presigned URL to the ClamAV API `/api/v1/scan/url` endpoint
4. Prints the scan result

### Usage

```bash
# With defaults (MinIO on localhost:9000, API on localhost:8080)
python scripts/scan_url_client.py /path/to/file.pdf

# With custom endpoints
python scripts/scan_url_client.py /path/to/file.pdf \
  --api-url http://localhost:8080 \
  --s3-endpoint http://localhost:9000 \
  --s3-bucket scans
```

### Options

| Option             | Default                  | Description                        |
| ------------------ | ------------------------ | ---------------------------------- |
| `file`             | *(required)*             | Path to the file to scan           |
| `--api-url`        | `http://localhost:8080`  | ClamAV API base URL                |
| `--s3-endpoint`    | `http://localhost:9000`  | S3/MinIO endpoint                  |
| `--s3-access-key`  | `minioadmin`             | S3 access key                      |
| `--s3-secret-key`  | `minioadmin`             | S3 secret key                      |
| `--s3-bucket`      | `scans`                  | S3 bucket name                     |
| `--url-expiry`     | `3600`                   | Presigned URL expiry in seconds    |

### Exit codes

| Code | Meaning  |
| ---- | -------- |
| `0`  | Clean    |
| `1`  | API error (non-200 response) |
| `2`  | Infected |
| `3`  | Scan error |

### Prerequisites

Start the services before running the script:

```bash
task run:simple
```

### Note

When running with Docker Compose, the API container accesses MinIO via `http://minio:9000` (Docker network), but the presigned URL generated by this script will contain `localhost:9000`. Make sure the API container can reach MinIO at the hostname present in the presigned URL.
